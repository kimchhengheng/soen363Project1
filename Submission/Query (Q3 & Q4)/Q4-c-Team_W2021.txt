-- C
-- USING MATERIALIZED VIEWS
-- THE EXECUTION TIME WENT FROM 45.926 (WITHOUT INDEXES) TO 28.763 (WITH INDEXES) 
-- TO 0.023 (WITH MATERIALIZED VIEWS) SECONDS. THIS IS A REALLY SIGNIFICANT IMPROVEMENT.
CREATE MATERIALIZED VIEW MATERIALIZED_NUM_COACTORS_PER_ACTOR AS
SELECT CA.MAIN_ACTOR, COUNT(*) AS NUM_CA     
FROM   (SELECT DISTINCT A1.NAME AS MAIN_ACTOR, A2.NAME
        FROM MOVIES M, ACTORS A1, ACTORS A2
        WHERE A1.MID = M.MID AND A2.MID=M.MID AND A2.NAME <> A1.NAME) CA 
GROUP BY CA.MAIN_ACTOR;

SELECT *
FROM MATERIALIZED_NUM_COACTORS_PER_ACTOR
WHERE NUM_CA = (SELECT MAX(NUM_CA) FROM MATERIALIZED_NUM_COACTORS_PER_ACTOR)
ORDER BY MAIN_ACTOR ASC;
